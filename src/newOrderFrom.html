<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>发货商信息</title>
    <link rel="stylesheet" type="text/css" href="css/common.css" />
    <link rel="stylesheet" href="css/mui.picker.min.css" />
    <link rel="stylesheet" type="text/css" href="css/newFromToItBa.css" />
</head>
<body>

<div id="newOrderApp">
    <div class="header">
        <a href="javascript:;" class="returnBtn" v-on:click="goBackNewOrder()"></a>
        <p class="txt">发货商信息</p>
        <b class="right"></b>
    </div>
    <div class="content newOrderMain">
        <div class="orderInf fromToInf">
            <!--新样式-->
            <div class="oederFroms">
                <div class="float_l">
                    <ul class="oederFromsUl">
                        <li>
                            <span class="oederFromsLi1">发货商名称</span>
                            <p class="oederFromsLi2">
                                <input disabled type="text" v-model="shipperParty.partyName" placeholder="发货商名称" class="form-control"/>
                            </p>
                        </li>
                        <li>
                            <span class="oederFromsLi1">发货商代码</span>
                            <p class="oederFromsLi2">
                                <input disabled type="text" v-model="shipperParty.partyCode" placeholder="发货商代码" class="form-control"/>
                            </p>
                        </li>
                    </ul>
                </div>
                <div class="float_l" v-on:click="choosePartyContactAddressFun('party','from','')">可选发货商</div>
            </div>
            <div class="oederFroms">
                <div class="float_l">
                    <ul class="oederFromsUl">
                        <li>
                            <span class="oederFromsLi1">发货商联系人</span>
                            <p class="oederFromsLi2">
                                <input v-model="shipperPartyContact.contactName" type="text" placeholder="发货商联系人" />
                            </p>
                        </li>
                        <li>
                            <span class="oederFromsLi1">联系人电话</span>
                            <p class="oederFromsLi2">
                                <input v-model="shipperPartyContact.contactTel" type="text" placeholder="联系人电话" />
                            </p>
                        </li>
                    </ul>
                </div>
                <div class="float_l" v-on:click="choosePartyContactAddressFun('contact','from','0')">可选联系人</div>
            </div>
            <ul style="padding-bottom: 0.1rem;">
                <li class="twoItem twoItem2">
                    <span class="txt">发货地址名称</span>
                    <p class="inp">
                        <input v-model="shipperPartyLocation.locationName" type="text" placeholder="发货地址名称" />
                    </p>
                    <p class="select" v-on:click="choosePartyContactAddressFun('address','from','')">可选地址</p>
                </li>
                <li>
                    <span class="txt">地址编码</span>
                    <p class="inp">
                        <input v-model="shipperPartyLocation.locationCode" type="text" placeholder="地址编码" />
                    </p>
                </li>
                <li class="fourItem">
                    <span class="txt">国省市区</span>
                    <select v-model="shipperPartyLocation.countryCode" v-on:change="selectLocLevelFun('countryCode',shipperPartyLocation,shipperPartyLocation.countryCode)" name="">
                        <option value="">国/洲</option>
                        <option v-for="addressItem in getAllCountryList" v-bind:value="addressItem.adcode">{{addressItem.chineseName}}</option>
                    </select>
                    <select v-model="shipperPartyLocation.provinceCode" v-on:change="selectLocLevelFun('provinceCode',shipperPartyLocation,shipperPartyLocation.provinceCode)"  name="">
                        <option value="">省份/自治区</option>
                        <option v-for="addressItem in getAllProviceList(shipperPartyLocation.countryCode)" v-bind:value="addressItem.adcode">{{addressItem.chineseName}}</option>
                    </select>
                    <select v-model="shipperPartyLocation.cityCode" v-on:change="selectLocLevelFun('cityCode',shipperPartyLocation,shipperPartyLocation.cityCode)" name="">
                        <option value="">城市/地区</option>
                        <option v-for="addressItem in getAllCityList(shipperPartyLocation.provinceCode)" v-bind:value="addressItem.adcode">{{addressItem.chineseName}}</option>
                    </select>
                    <select v-model="shipperPartyLocation.districtCode" v-on:change="selectLocLevelFun('districtCode',shipperPartyLocation,shipperPartyLocation.districtCode)" name="">
                        <option value="">区/县</option>
                        <option v-for="addressItem in getAllDistrictList(shipperPartyLocation.cityCode)" v-bind:value="addressItem.adcode">{{addressItem.chineseName}}</option>
                    </select>
                </li>
                <li>
                    <span class="txt">街道</span>
                    <p class="inp">
                        <input v-model="shipperPartyLocation.street" v-on:blur="changeAddress(shipperPartyLocation,shipperPartyLocation.street,'0')" type="text" placeholder="街道" />
                    </p>
                </li>
            </ul>
            <div class="oederFroms">
                <div class="float_l">
                    <ul class="oederFromsUl">
                        <li>
                            <span class="oederFromsLi1">发货地联系人</span>
                            <p class="oederFromsLi2">
                                <input v-model="shipperPartyLocationContact.contactName" type="text" placeholder="发货地联系人" />
                            </p>
                        </li>
                        <li>
                            <span class="oederFromsLi1">联系人电话</span>
                            <p class="oederFromsLi2">
                                <input v-model="shipperPartyLocationContact.contactTel" type="text" placeholder="联系人电话" />
                            </p>
                        </li>
                    </ul>
                </div>
                <div class="float_l" v-on:click="choosePartyContactAddressFun('contact','from','1')">可选联系人</div>
            </div>

        </div>
        <div class="orderBottom1">
            <a href="javascript:;" v-on:click="saveNewOrderFromInfo()">保存</a>
        </div>
    </div>
</div>

<script src="js/jquery-2.1.0.js" type="text/javascript"></script>
<script src="js/common.js" type="text/javascript"></script>
<script src="js/env_config.js" type="text/javascript"></script>
<script src="js/vue.js" type="text/javascript"></script>
<script src="js/mui.js"></script>
<script src="js/mui.picker.min.js"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script type="text/javascript">
    document.write("<s" + "cript type='text/javascript' src='js/getlocation.js?v=" + verson + "'></s" + "cript>");
</script>
<script type="text/javascript">
    var app = new Vue({
        el: '#newOrderApp',
        data: {
            selectListData:{},
            shipperParty:{
                partyName:"",
                partyCode:"",
                isBuyer:null,
                isVendor:null,
                isTruck:null,
                isWarehouse:null,
                is3pl:null
            },
            shipperPartyContact:{
                contactName:"",
                contactTel:"",
                contactEmail:""
            },
            shipperPartyLocation:{
                locationName:"",
                //    locationType:null,
                locationCode:"",
                countryCode:"100000",
                provinceCode:"",
                cityCode:"",
                districtCode:"",
                street:"",
                postCode:"",
                address:""
            },
            shipperPartyLocationContact:{
                contactName:"",
                contactTel:""
            },
            getAllCountryList:{}, // 国家列表
            address00:"", // 改变 address —— 国
            address0:"", // 改变 address —— 省
            address1:"", // 改变 address —— 市
            address2:"", // 改变 address —— 区
            address3:"" // 改变 address —— 街道
        },
        methods:{
            goBackNewOrder(){
                window.location.href = "newOrder.html";
            },
            // 跳去 合作商、联系人、地址 列表，入参：type（合作商party、联系人contact、地址address）、orderPartyType（发货商from、收货商to）、contanctBtnType（0-合作商联系人、1-地址联系人）
            choosePartyContactAddressFun(type,orderPartyType,contanctBtnType){
                window.location.href = "newOrderselectList.html?type="+type+"&orderPartyType="+orderPartyType+"&contanctBtnType="+contanctBtnType;
            },
            // cdm基础数据 选择国省市区，以及输入街道改变详细地址 ——————— start
            selectLocLevelFun(level,paramObj,code){ // 选中国省市区触发事件，入参：地址级别，对象，当前 国、省、市、区 编码 [ 便于扩展实时改变 详细地址address ]
                var that = this;
                switch(level)
                {
                    case 'countryCode':
                        paramObj.provinceCode = "";
                        paramObj.cityCode = "";
                        paramObj.districtCode = "";
                        break;
                    case 'provinceCode':
                        paramObj.cityCode = "";
                        paramObj.districtCode = "";
                        break;
                    case 'cityCode':
                        paramObj.districtCode = "";
                        break;
                    case 'districtCode':

                        break;
                }
                that.changeAddressFun(level,paramObj,code);
            },
            getAllProviceList(countryCode){ // 根据所选的 countryCode 获取对应 省列表
                return getProvinceData(countryCode);
            },
            getAllCityList(provinceCode){ // 根据所选的 provinceCode 获取对应 市列表
                return getCityData(provinceCode);
            },
            getAllDistrictList(cityCode){ // 根据所选的 cityCode 获取对应 区列表
                return getDistrictData(cityCode);
            },
            changeAddressFun(level,paramObj,code){ // 选择国省市区，实时改变 详细地址 address ，入参：地址级别，当前 国、省、市、区 编码
                var that = this;
                switch(level)
                {
                    case 'countryCode': // 选择 国 ，改变 address
                        if(code == ''){
                            that.address00 = '';
                        }else{
                            $.each(that.getAllCountryList, function (indexs, val) {
                                if (val.adcode == code) {
                                    that.address00 = val.chineseName;
                                }
                            });
                        }
                        that.address0 = '';
                        that.address1 = '';
                        that.address2 = '';
                        break;
                    case 'provinceCode': // 选择 省 ，改变 address
                        if(code == ''){
                            that.address0 = '';
                        }else{
                            $.each(that.getAllProviceList(paramObj.countryCode), function (indexs, val) {
                                if (val.adcode == code) {
                                    that.address0 = val.chineseName;
                                }
                            });
                        }
                        that.address1 = '';
                        that.address2 = '';
                        break;
                    case 'cityCode': // 选择 市 ，改变 address
                        if(code == ''){
                            that.address1 = '';
                        }else{
                            $.each(that.getAllCityList(paramObj.provinceCode), function (indexs, val) {
                                if (val.adcode == code) {
                                    that.address1 = val.chineseName;
                                }
                            });
                        }
                        that.address2 = '';
                        break;
                    case 'districtCode': // 选择 区 ，改变 address
                        if(code == ''){
                            that.address2 = '';
                        }else{
                            $.each(that.getAllDistrictList(paramObj.cityCode), function (indexs, val) {
                                if (val.adcode == code) {
                                    that.address2 = val.chineseName;
                                }
                            });
                        }
                        break;
                }
                if(paramObj.street != '' && paramObj.street != undefined && paramObj.street != null){
                    that.address3 = paramObj.street;
                }else{
                    that.address3 = '';
                }
                paramObj.address = that.address00 + that.address0 + that.address1 + that.address2 + that.address3;
            },
            changeAddress(paramObj,street,type){ // 输入街道，改变 address
                var that = this;
                if(street == undefined){
                    return false;
                }
                that.address3 = street;
                switch(type)
                {
                    case '0': // 发货商，改变 address
                        that.changeAddressFun('countryCode',that.shipperPartyLocation,that.shipperPartyLocation.countryCode);
                        that.changeAddressFun('provinceCode',that.shipperPartyLocation,that.shipperPartyLocation.provinceCode);
                        that.changeAddressFun('cityCode',that.shipperPartyLocation,that.shipperPartyLocation.cityCode);
                        that.changeAddressFun('districtCode',that.shipperPartyLocation,that.shipperPartyLocation.districtCode);
                        break;
                    case '1': // 收货商，改变 address
                        that.changeAddressFun('countryCode',that.receiptPartyLocation,that.receiptPartyLocation.countryCode);
                        that.changeAddressFun('provinceCode',that.receiptPartyLocation,that.receiptPartyLocation.provinceCode);
                        that.changeAddressFun('cityCode',that.receiptPartyLocation,that.receiptPartyLocation.cityCode);
                        that.changeAddressFun('districtCode',that.receiptPartyLocation,that.receiptPartyLocation.districtCode);
                        break;
                }
                paramObj.address = that.address00 + that.address0 + that.address1 + that.address2 + that.address3;
            },
            resetAddressParamFun(type){ // 重置 改变address 参数，入参：类型（全重置、默认国家“中国”）
                var that = this;
                switch(type)
                {
                    case '0':
                        that.address00 = '';
                        that.address0 = '';
                        that.address1 = '';
                        that.address2 = '';
                        that.address3 = '';
                        break;
                    case '1':
                        that.address00 = '中国';
                        that.address0 = '';
                        that.address1 = '';
                        that.address2 = '';
                        that.address3 = '';
                        break;
                }
            },
            getAddressParamFun(level,paramObj,code){ // 赋值 改变address 参数
                var that = this;
                switch(level)
                {
                    case 'countryCode':
                        if(code != null && code != ''){
                            $.each(that.getAllCountryList, function (indexs, val) {
                                if (val.adcode == code) {
                                    that.address00 = val.chineseName;
                                }
                            });
                        }else{
                            that.address00 = '';
                            paramObj.countryCode = "";
                        }
                        break;
                    case 'provinceCode':
                        if(code != null && code != ''){
                            $.each(that.getAllProviceList(paramObj.countryCode), function (indexs, val) {
                                if (val.adcode == code) {
                                    that.address0 = val.chineseName;
                                }
                            });
                        }else{
                            that.address0 = '';
                            paramObj.provinceCode = "";
                        }
                        break;
                    case 'cityCode':
                        if(code != null && code != ''){
                            $.each(that.getAllCityList(paramObj.provinceCode), function (indexs, val) {
                                if (val.adcode == code) {
                                    that.address1 = val.chineseName;
                                }
                            });
                        }else{
                            that.address1 = '';
                            paramObj.cityCode = "";
                        }
                        break;
                    case 'districtCode':
                        if(code != null && code != ''){
                            $.each(that.getAllDistrictList(paramObj.cityCode), function (indexs, val) {
                                if (val.adcode == code) {
                                    that.address2 = val.chineseName;
                                }
                            });
                        }else{
                            that.address2 = '';
                            paramObj.districtCode = "";
                        }
                        break;
                }
            },
            // cdm基础数据 选择国省市区，以及输入街道改变详细地址 ——————— end
            saveNewOrderFromInfo(){
                var that = this;
                if(that.shipperParty.partyName == "" || that.shipperParty.partyCode == ""){
                    loadData("show","请选择发货商",true)
                    return false;
                }
                if(that.shipperPartyContact.contactName == "" || that.shipperPartyContact.contactTel == ""){
                    loadData("show","请填写发货商联系人、联系人电话",true)
                    return false;
                }
                if(that.shipperPartyLocation.locationName == "" || that.shipperPartyLocation.locationCode == ""){
                    loadData("show","请填写发货地址名称、地址编码",true)
                    return false;
                }
                if(that.shipperPartyLocation.countryCode == ""){
                    loadData("show","请选择国/洲",true)
                    return false;
                }
                if(that.shipperPartyLocation.provinceCode == ""){
                    loadData("show","请选择省份/自治区",true)
                    return false;
                }
                if(that.shipperPartyLocation.cityCode == ""){
                    loadData("show","请选择城市/地区",true)
                    return false;
                }
                if(that.shipperPartyLocation.districtCode == ""){
                    loadData("show","请选择区/县",true)
                    return false;
                }
                if(that.shipperPartyLocation.street == ""){
                    loadData("show","请填写街道",true)
                    return false;
                }
                if(that.shipperPartyLocationContact.contactName == "" || that.shipperPartyLocationContact.contactTel == ""){
                    loadData("show","请填写发货地联系人、联系人电话",true)
                    return false;
                }

                var shipperPartyInfoModel = {};
                shipperPartyInfoModel.party = that.shipperParty;  // 1-发货商基本信息
                shipperPartyInfoModel.imgContact = that.shipperPartyContact;  // 2-发货商紧急联系人
                shipperPartyInfoModel.location = that.shipperPartyLocation;  // 3-发货商地址信息
                shipperPartyInfoModel.contact = that.shipperPartyLocationContact;  // 4-发货商地址联系人

                localStorage.setItem("newOrderFromInfo",JSON.stringify(shipperPartyInfoModel));
                localStorage.removeItem("trShipperParty");  // 清除 所选发货商
                localStorage.removeItem("trShipperPartyContact");  // 清除 所选发货商联系人
                localStorage.removeItem("trShipperPartyLocation");  // 清除 所选发货地址
                localStorage.removeItem("trShipperPartyLocationContact");  // 清除 所选发货地址联系人
                window.location.href = "newOrder.html";
            }
        },
        created:function(){
            var that = this;
            that.getAllCountryList = getCountryData();
            that.logininf = JSON.parse(localStorage.getItem("logininf"));
            initSelectData(that);
            that.selectListData = JSON.parse(localStorage.getItem("newOrderBasicData"));    //获取下拉数据
            // 已保存的发货商
            if(localStorage.getItem("newOrderFromInfo") != null){
                var shipperPartyInfoModel = JSON.parse(localStorage.getItem("newOrderFromInfo"));
                that.shipperParty = shipperPartyInfoModel.party;  // 发货商
                that.shipperPartyContact = shipperPartyInfoModel.imgContact;  // 紧急联系人
                that.shipperPartyLocation = shipperPartyInfoModel.location;  // 地址信息
                that.shipperPartyLocationContact = shipperPartyInfoModel.contact;  // 发货地联系人信息
            }
            // 所选发货商
            if(localStorage.getItem("trShipperParty") != null){
                that.shipperParty = JSON.parse(localStorage.getItem("trShipperParty"));
            }
            // 所选发货商联系人
            if(localStorage.getItem("trShipperPartyContact") != null){
                that.shipperPartyContact = JSON.parse(localStorage.getItem("trShipperPartyContact"));
            }
            // 所选发货地址
            if(localStorage.getItem("trShipperPartyLocation") != null){
                that.shipperPartyLocation = JSON.parse(localStorage.getItem("trShipperPartyLocation"));
            }
            // 所选发货地址联系人
            if(localStorage.getItem("trShipperPartyLocationContact") != null){
                that.shipperPartyLocationContact = JSON.parse(localStorage.getItem("trShipperPartyLocationContact"));
            }
        }
    });

    function initSelectData(that){
        that.shipperParty = { // 发货商
            partyName:"",
            partyCode:"",
            isBuyer:null,
            isVendor:null,
            isTruck:null,
            isWarehouse:null,
            is3pl:null
        };
        that.shipperPartyContact = { // 发货商 联系人
            contactName:"",
            contactTel:"",
            contactEmail:""
        };
        that.shipperPartyLocation = { // 发货地
            locationName:"",
            //    locationType:null,
            locationCode:"",
            countryCode:"100000",
            provinceCode:"",
            cityCode:"",
            districtCode:"",
            street:"",
            postCode:"",
            address:""
        };
        that.shipperPartyLocationContact = { // 发货地 联系人
            contactName:"",
            contactTel:""
        };
    }

    $(function(){
        // 获取当前位置
        getLocationFun();

        /* 微信中不隐去.header */
        var ua = window.navigator.userAgent.toLowerCase();
        /*if(ua.match(/MicroMessenger/i) == 'micromessenger'){
            $(".header").show();
            $(".content.newOrderMain").css({
                "marginTop":"0.88rem"
            })
        }*/
    })
</script>

<script>
    (function($) {
        $.init();
        var result = $('#result')[0];
        var btns = $('.muiDateBtn');
        var flag = true;
        btns.each(function(i, btn) {
            btn.addEventListener('tap', function() {
                var that = this;
                setTimeout(function(){
                    flag = true;
                },100);
                if(flag){
                    var optionsJson = this.getAttribute('data-options') || '{}';
                    var options = JSON.parse(optionsJson);
                    var id = this.getAttribute('id');
                    var picker = new $.DtPicker(options);
                    picker.show(function(rs) {
                        that.value = rs.text;
                        picker.dispose();
                    });

                    flag  = false;
                }

            }, false);
        });
    })(mui);
</script>

</body>
</html>