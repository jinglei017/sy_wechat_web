<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>全部商品</title>
    <link rel="stylesheet" href="css/common.css" />
    <link rel="stylesheet" href="css/inventory.css" />
</head>
<body>

<div id="newOrderApp">
    <div class="header">
        <a href="javascript:;" class="returnBtn" onclick="javascript:history.back(-1)"></a>
        <p class="txt">全部商品</p>
        <p class="right">
            <img src="images/search1.png" class="searchBtn" alt="" />
        </p>
    </div>

    <!--查询、重置-->
    <div class="searchLayer">
        <div class="searchCon">
            <ul>
                <li>
                    <span>标签:</span><input type="text" v-model="queryParam.itemLabel" placeholder="请输入商品标签">
                </li>
                <li>
                    <span>编码:</span><input type="text" v-model="queryParam.itemCode" placeholder="请输入商品编码">
                </li>
                <li>
                    <span>条码号:</span><input type="text" v-model="queryParam.itemBarCode" placeholder="请输入条码号">
                </li>
            </ul>
            <p class="searchbtn">
                <span class="searchspan" v-on:click="getSearchVal('0')">查询</span>
                <span class="bg_white searchspan" v-on:click="resetSearchVal()">重置</span>
            </p>
        </div>
    </div>

    <!--列表-->
    <div class="main">
        <div class="itemDiv" v-for="(itemInfo,index) in itemInfoList" v-on:click="selectItemInfoFun(itemInfo,index)">
            <div class="float_l itemCon">

                <!--<div class="itemLis itemTxt"><span>{{itemInfo.itemLabel}}</span></div>
                <div class="itemLis itemTxt"><span style="color: #666;">商品编码:&nbsp;{{itemInfo.itemCode}}</span></div>
                <div class="itemLis itemTxt"><span style="color: #666;">条码号:&nbsp;{{itemInfo.itemBarCode}}</span></div>-->

                <div class="itemLis itemTxt"><span>{{itemInfo.itemLabel}}</span></div>
                <ul class="itemLis">
                    <li class="float_l text_l itemLi1"><span class="color_titles">编码:&nbsp;</span><span>{{itemInfo.itemCode}}</span></li>
                    <li class="float_l text_l itemLi2"><span class="color_titles">条码:&nbsp;</span><span>{{itemInfo.itemBarCode}}</span></li>
                </ul>
                <ul class="itemLis">
                    <li class="float_l text_l itemLi1"><span class="color_titles">自编码:&nbsp;</span><span>{{itemInfo.itemNo}}</span></li>
                    <li class="float_l text_l itemLi2"><span class="color_titles">货主:&nbsp;</span><span>{{itemInfo.partyName}}</span></li>
                </ul>

            </div>
        </div>
    </div>

</div>

<script src="js/jquery-2.1.0.js" type="text/javascript"></script>
<script src="js/common.js" type="text/javascript"></script>
<script src="js/env_config.js" type="text/javascript"></script>
<script src="js/vue.js" type="text/javascript"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script type="text/javascript">
    document.write("<s" + "cript type='text/javascript' src='js/getlocation.js?v=" + verson + "'></s" + "cript>");
</script>
<script type="text/javascript">
    var app = new Vue({
        el: '#newOrderApp',
        data: {
            queryParam:{
                itemCode:"",
                itemLabel:"",
                itemBarCode:""
            },
            itemInfoList:[],
            pageNum:1,
            pages:0
        },
        methods:{
            getSearchVal(type){
                var that = this,newArray = [],cenArray = [];
                var searchFormArr = that.queryParam;
                if(searchFormArr.itemCode == ''){
                    searchFormArr.itemCode = undefined;
                }
                if(searchFormArr.itemLabel == ''){
                    searchFormArr.itemLabel = undefined;
                }
                if(searchFormArr.itemBarCode == ''){
                    searchFormArr.itemBarCode = undefined;
                }
                switch(type)
                {
                    case '0':  // 搜索
                        that.pageNum = 1;
                        that.pages = 0;
                        that.itemInfoList = [];
                        break;
                    case '1':  // 按现有加载

                        break;
                }
                searchFormArr.pageInfo = {
                    pageNum:that.pageNum,
                    pageSize:12
                };
                postRequest(pidUrl + "/select/pageItemByItemVo.json?token="+that.logininf.token+"&timeStamp="+that.logininf.timeStamp,searchFormArr,function(res){
                    if(res.result != null){
                        if(res.result.length != 0){
                            newArray = res.result;
                            cenArray = that.itemInfoList;
                            if(cenArray.length != 0){
                                $.each(newArray, function (index, itemm) {
                                    cenArray.push(itemm);
                                });
                                that.itemInfoList = cenArray;
                            }else{
                                that.itemInfoList = newArray;
                            }
                        }
                        that.pages = res.pageInfo.pages;
                    }else{
                        that.itemInfoList = [];
                    }
                    that.pageNum++;
                    $(".searchLayer").hide();
                });
            },
            resetSearchVal(){
                var that = this;
                that.queryParam = {};
                that.getSearchVal('0');
            },
            selectItemInfoFun(itemInfo,index){
                localStorage.setItem("itemInfoIndex",getUrlParam('index'));
                var param = {
                    orderItem: itemInfo
                };
                localStorage.setItem("itemInfo",JSON.stringify(param));
                window.location.href = "newOrderItems.html";
            }
        },
        created:function(){
            var that = this,newArray = [],cenArray = [];
            that.logininf = JSON.parse(localStorage.getItem("logininf"));
            $(window).scroll(function () {
                var scrollTop = $(this).scrollTop();
                var scrollHeight = $(document).height();
                var windowHeight = $(this).height();
                if((scrollTop + windowHeight === scrollHeight) && (that.pageNum < that.pages || that.pageNum == that.pages)){
                    that.getSearchVal('1');
                }
            });
            var searchFormArr = {
                pageInfo:{
                    pageNum:that.pageNum,
                    pageSize:12
                }
            };
            postRequest(pidUrl + "/select/pageItemByItemVo.json?token="+that.logininf.token+"&timeStamp="+that.logininf.timeStamp,searchFormArr,function(res){
                if(res.result != null){
                    if(res.result.length != 0){
                        newArray = res.result;
                        cenArray = that.itemInfoList;
                        if(cenArray.length != 0){
                            $.each(newArray, function (index, itemm) {
                                cenArray.push(itemm);
                            });
                            that.itemInfoList = cenArray;
                        }else{
                            that.itemInfoList = newArray;
                        }
                    }
                    that.pages = res.pageInfo.pages;
                }else{
                    that.itemInfoList = [];
                }
                that.pageNum++;
            });
        }
    });

    $(function () {
        // 获取当前位置
        getLocationFun();

        /* 微信中不隐去.header */
        var ua = window.navigator.userAgent.toLowerCase();
        /*if(ua.match(/MicroMessenger/i) == 'micromessenger'){
            $(".header").show();
            $(".main").css({
                "marginTop":"0.88rem"
            })
        }*/

        /* 点击查询 */
        $(".header .right").click(function(){
            if(!$(this).hasClass('search')){
                $(this).addClass('search');
                $(".searchLayer").show();
            }else{
                $(this).removeClass('search');
                $(".searchLayer").hide();
            }
        });
    });

</script>
</body>
</html>